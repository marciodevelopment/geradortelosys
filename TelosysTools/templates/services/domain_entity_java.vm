##https://github.com/telosys-templates

## --------------------------------------------------
#if ( $entity.isJoinEntity() )
#cancel("No JPA class for join entity")
#end
## --------------------------------------------------
#checkId($entity)
#parse("include/init_var_entity.vm")
#parse("include/java_header.vm")
##---------------------------------------------------------------------------------------
##                 JPA CONFIGURATION
##---------------------------------------------------------------------------------------
## Define the default collection type to be used (default is "java.util.List" )
#set($env.collectionType = "java.util.Set")
## #set($env.collectionType = "java.util.Collection")
## ---------------------------
## Define if "targetEntity" must be generated in @ManyToMany or @OneToMany
## #set($jpa.genTargetEntity = true)
## ---------------------------
## Define default value (true or false) for "insertable" and "updatable" in "@JoinColumn"
#set($jpa.joinColumnInsertable = true) 
#set($jpa.joinColumnUpdatable  = true)
## ---------------------------
## Set default FETCH-TYPE for each cardinality ( "LAZY" or "EAGER" )
#set($jpa.manyToOneFetchType  = "LAZY" )
#set($jpa.oneToOneFetchType   = "LAZY" )
#set($jpa.oneToManyFetchType  = "LAZY" )
#set($jpa.manyToManyFetchType = "LAZY" )
##---------------------------------------------------------------------------------------
package ${target.javaPackageFromFolder(${SRC})};
## IF ENTITY HAS A COMPOSITE PRIMARY KEY => GENERATE AN 'ID CLASS' FOR THIS PRIMARY KEY
#if ( $entity.hasCompositePrimaryKey() )
$generator.generate($target.entityName ,  "${jpaEntityIdClass}.java", $target.folder, "main-java/XxxJpaEntityId_java.vm" )
#end

## if has type attribute
#set($typeAttributes = [])
#foreach ($attribute in $entity.nonKeyAttributes)
    #if ($attribute.hasTag('typeValues'))
      #if ($typeAttributes.add($attribute))
      #end
    #end
#end

#foreach ($attribute in $typeAttributes)
#set($typeFolder = "${target.folder}/types")
#set($enumAttributeName = $attribute.name)
$generator.generate($target.entityName , "${attribute.name.replace('id', '')}Type.java", $typeFolder, "enum_template.vm")
$generator.generate($target.entityName , "${attribute.name.replace('id', '')}Converter.java", $typeFolder, "enum_converter_template.vm")
#end


#set($existsIdSituacao = false)
#foreach ($attribute in $entity.nonKeyAttributes)
    #if ($attribute.name.contains('idSituacao'))
      #set($existsIdSituacao = true)
    #end
#end

import java.io.Serializable;
#if ($existsIdSituacao)
import org.hibernate.annotations.SQLDelete;
import org.hibernate.annotations.Where;
#end
#foreach( $import in $java.imports($entity) )
import $import;
#end
#foreach( $import in $jpa.imports($entity) )
import $import;
#end

/**
 * JPA entity class for "${entity.name}"
 *
 * @author Telosys
 *
 */

#if ($existsIdSituacao)
@Where(clause = " idSituacao <> 0 ")
@SQLDelete(sql = "UPDATE ${entity.name} SET idSituacao = 0 WHERE cd${entity.name} = ? ")
#end
@Accessors(chain = true)
@NoArgsConstructor(access = AccessLevel.PROTECTED)
$jpa.entityAnnotations(0, $entity)
public class ${entity.name}Entity implements Serializable {
  private static final long serialVersionUID = 1L;

#foreach( $attribute in $entity.keyAttributes )
	$jpa.fieldAnnotations(2, $attribute)
    private $attribute.formattedType(10) $attribute.name #if($attribute.hasInitialValue())= ${attribute.ini} #end;
#end
     
#foreach( $attribute in $entity.nonKeyAttributes )
#if	( $attribute.hasTag('web') )
  #if ( $attribute.tagValue('web').contains('pesquisar') || $attribute.tagValue('web').contains('get') )
  @Getter
  #end
#end
#if ( !($attribute.isNotBlank() || $attribute.isNotNull() || $attribute.isNotEmpty()) )
  @Setter 
#end
#set($Q = '"')
#set($message = "${attribute.tagValue('mensagem')}")
#if ( $beanValidation.annotationsForWrapperType( 4, $attribute ).contains(')') )
$beanValidation.annotationsForWrapperType( 4, $attribute ).replace(')', ", message=$Q$message$Q)")
#elseif (!$beanValidation.annotationsForWrapperType( 4, $attribute ).equals(''))
$beanValidation.annotationsForWrapperType( 4, $attribute )(message=$Q$message$Q)
#end
#if	( $attribute.hasTag('typeValues') )
  private $attribute.name.replace('id', '')Type $attribute.name; 

#else
  private $attribute.formattedWrapperType(10) $attribute.name #if($attribute.hasInitialValue())= ${attribute.ini} #end;

#end
#end

#foreach( $link in $entity.links )
## all annotations : Cardinality, JoinColumn(s), etc
##--- with "insertable=false, updatable=false" if attribute already mapped
$jpa.linkAnnotations(4, $link, $entity.attributes)
##--- no "insertable=false, updatable=false" if already mapped
## $jpa.linkAnnotations(4, $link)
##--- Just @Cardinality annotation
## $jpa.linkCardinalityAnnotation(4, $link) 
##--- Just @JoinColumn(s) annotation(s)
## $jpa.linkJoinAnnotation(4, $link) 
## $jpa.linkJoinAnnotation(4, $link, $entity.attributes)
  #if ($link.isOptionalFalse())
    @NotNull(message="")	
  #end
#set($entitySimpleType = ${link.targetEntitySimpleType}  + 'Entity')
#set($atributteEnityName = $link.formattedFieldType(0).replace($link.targetEntitySimpleType, $entitySimpleType))
  private ${atributteEnityName} $link.fieldName ; 
#end

#set($nonNullAttributes = [])
#foreach ($attribute in $entity.nonKeyAttributes)
    #if ($attribute.name.contains('idSituacao'))
    #elseif ( $attribute.isNotBlank() || $attribute.isNotNull() || $attribute.isNotEmpty())
      #if ($nonNullAttributes.add($attribute))
      #end
    #end
#end

  public ${entity.name}Entity (#foreach ($attribute in $nonNullAttributes)
#if	( $attribute.hasTag('typeValues') )
$attribute.name.replace('id', '')Type
#else
$attribute.formattedWrapperType(10)
#end
$attribute.name#if (!$foreach.last),#end#end) {
#foreach ($attribute in $nonNullAttributes)
    this.$attribute.name = $attribute.name;
#end
#if ($existsIdSituacao)
    this.idSituacao = SituacaoType.ATIVO;
#end
  }

#set($updateAttributes = [])
#foreach ($attribute in $entity.nonKeyAttributes)
    #if ($attribute.hasTag('web') && $attribute.tagValue('web').contains('put'))
      #if ($updateAttributes.add($attribute))
      #end
    #end
#end


#if (!$updateAttributes.isEmpty())
  public ${entity.name}Entity atualizar (#foreach ($attribute in $updateAttributes)
#if	( $attribute.hasTag('typeValues') )
$attribute.name.replace('id', '')Type
#else
$attribute.formattedWrapperType(10)
#end 
$attribute.name#if (!$foreach.last),#end#end) {
#foreach ($attribute in $updateAttributes)
    this.$attribute.name = $attribute.name;
#end
    return this;
  }
#end

}